---
layout: poslay
title: TeamChat开发手记——3
label: Node
kind: 
ptr: 
mdmark: ran
metakey:
metades:
---

最近在做RTCA的第二阶段工程。从上周二到现今天，我花了一周的时间去重构其原型，并抛弃了原先的设计模式，重新考虑了架构、代码质量以及执行效率。这一过程很累，不过也算是对Node.js及其开发有了一个全新的认识和体会吧。

当我决定重构时，心里已经对如何解决即将面临的困难有了把握，所以开始的异常迅速：构建了四个数据模型。经历了两次基于MVC模型的自由开发后，对MVC已经不再畏惧了，毫无疑问M（Model）是重中之重，所以先把Model设计好，也就是把核心问题——“数据操作”解决了。接下来是C（Controller）的设计。数据那部分都已经交给Model去做了，Controller的工作就是根据路由请求做出不同的响应。所谓的业务逻辑都应该在这里实现，难度倒是没什么，最多也就是设计几个小算法，不过让人头疼的是与Model的交互：Controller需要从Model那里获取需要的数据，因此Model必须提供一些对外操作的接口，但是过多的接口总会出现调用混乱或是返回混乱的情况，每每出错大多在接口调用这里。

三天后除了Controller，Views也被我做好了，于是我便尝试运行了一下，几个入口程序中的错误排除之后，以为可以运行了，结果出现了以下一系列让我刻骨铭心的坑爹错误：

1. 视图模板出现语法错误
2. 数据库操作返回值的使用错误
3. 编码错误
4. 逻辑错误
5. 理解异步上的失误
6. 回调函数理解有误
7. WebSocket的使用错误

我大概分了这么几类，其中有几点我认为在今后的开发中值得关注。  
之后就是不断地Debug，到处console.log()。谈到console对象，不得不说它的log是一个对我帮助极大的函数：基本上70%的Debug工作全是由他帮助完成的。不过这是后话，现在谈谈这几个bugs。  
首先，玩非前端JavaScript一定要改变思维，不然会被Node中的各种异步与回调弄蒙圈的！其实Node的异步不是你想像的那样复杂，但也不是你随随便便就能理解的。